<style></style>
<template></template>
<script>
    class extends `./abstract/pointer` {

        #module
        #map
        #mapMap

        constructor() {
            super()
            Object.defineProperties(this, {
                _mode: {configurable: false, enumerable: false, writable: false, value: 'processor'}, 
                _isReference: {configurable: false, enumerable: false, writable: false, value: true}, 
                _apply: {configurable: false, enumerable: false, value: async (result, target) => {
                        this.#module = result
                        for (const [s, m] of Object.entries(this.mapMap)) this[s] = this.#module[m]
                        let applyMap = this.applyMap
                        if (applyMap) {
                            let applyEntries = Object.entries(this.applyMap ?? {})
                            for (const t of target) {
                                const elementMap = this.e.env.map.get(t) ?? {}
                                for (const [role, mm] of applyEntries) elementMap[role] = mm
                                this.e.env.map.set(t, elementMap)
                            }
                        }
                    }
                }

            })
        }

        static get observedAttributes() { return (super.observedAttributes || []).concat('parser') }

        set map(value) {
            this.#mapMap = this.e.utils.parseObjectAttribute(value)            
            this.#map = value 
        }
        get map() { return this.#map }
        get mapMap() {
            const attrMap = this.getAttribute('map')
            if (attrMap && attrMap!== this.#map) this.map = attrMap
            return this.#mapMap 
        }        

        get module() { return this.#module }

    }
</script>
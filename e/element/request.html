<style></style>
<template></template>
<script>
    class extends `./abstract/pipe` {

    	constructor() {
    		super()
            Object.defineProperties(this, {
                _class: {configurable: true, enumerable: false, value: 'Request'}, 
                _receiveEventName: {configurable: true, enumerable: false, value: 'message'}, 
                _receiveEventPayloadProperty: {configurable: true, enumerable: false, value: 'data'},
                _sendMethodName: {configurable: true, enumerable: false, value: 'send'}
            })
    	}

		static get observedAttributes() { return (super.observedAttributes || []).concat() }

        async _new(value) { return this.e.getURL(value) }

        async _send(payload) {
            const options = this._options
            options.body = ((payload instanceof Object) && (options.body instanceof Object)) ? {...options.body, payload} : payload
            const response = await fetch(this._resource, options)
            this.dispatchEvent(new CustomEvent('receive', {detail: response}))
            const result = this.e.parse(response.body)
            this.dispatchEvent(new CustomEvent('data', {detail: result}))
        }

        async set resource(value) {
            this._resource = value ? await this._new(value) : undefined
            this.#resource = value
        }

    }
</script>
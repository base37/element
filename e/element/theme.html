<style></style>
<template></template>
<script>
    class extends `./abstract/pointer` {

    	constructor() {
    		super()
            Object.defineProperties(this, {
                _mode: {configurable: false, enumerable: false, writable: false, value: 'theme'}, 
                _contentType: {configurable: false, enumerable: false, writable: false, value: 'text/css'}, 
                _apply: {configurable: false, enumerable: false, value: async (result, target) => {
                        let apply = this.apply ?? this.getAttribute('apply') ?? 'innerHTML'
                        if (this.dataset.stylesheetId) for (const ss of this.getRootNode().querySelectorAll(`style[data-stylesheet-id="${this.dataset.stylesheetId}"]`)) ss.remove()
                        this.dataset.stylesheetId = crypto.randomUUID()
                        for (const t of target) {
                            const styleNode = document.createElement('style')
                            styleNode.dataset.stylesheetId = this.dataset.stylesheetId
                            styleNode.textContent = Array.from(result.cssRules).map(r => r.cssText).join('\n')
                            if ((t.parentElement === document.head) || [document, document.head, document.body].includes(t)) {
                                apply === 'underlay' ? document.head.prepend(styleNode) : document.head.append(styleNode)
                            } else if (t instanceof ShadowRoot || t.shadowRoot instanceof ShadowRoot) {
                                const shadow = t instanceof ShadowRoot ? t : t.shadowRoot
                                apply === 'underlay' ? shadow.prepend(styleNode) : shadow.querySelector('style:last-of-type')?.after(styleNode)
                            }
                        }
                    }
                }

            })
    	}

		static get observedAttributes() { return (super.observedAttributes || []).concat() }

    }
</script>
<style></style>
<template><slot></slot></template>
<script>
    class extends `./abstract/socket` {

        #scope
        #observe
        #match

        constructor() {
            super()
            Object.defineProperties(this, {
                _getTargets: {value: async () => {
                    await this._socket._getTargets()
                    const observed = this.e.getObserved(this, this.#scope, this.#observe)                    
                    if (observed === this.parentElement && !this.#match) return [this.parentElement]
                    const recordsToTargets = recordsToProcess => recordsToProcess.filter(r => r.type==='childList').map(r => r.addedNode)
                            .filter(a => typeof a==='function' && a.matches(this.#match ||':scope')), 
                            activateTargetsFromRecords = recordsToProcess => this._connectTargets(recordsToTargets(recordsToProcess))
                    this.e.createObserver(this, observed, records => { this._connectTargets(activateTargetsFromRecords(records)) }, 
                        activateTargetsFromRecords)
                    return Array.from(observed.querySelectorAll(this.#match||':scope'))
                }},
                _transformEventDetail: {configurable: true, writable: true, value: event => {
                    return event
                }}
            })
        }

        static get observedAttributes() { return (super.observedAttributes || []).concat('scope', 'observe', 'match') }

        set scope(value) { this.#scope = value }
        get scope() { return this.#scope }

        set observe(value) { this.#observe = value }
        get observe() { return this.#observe }

        set match(value) { this.#match = value }
        get match() { return this.#match }

        get targets() { 
            const observed = this.e.getObserved(this, this.#scope, this.#observe)                    
            if (observed === this.parentElement && !this.#match) return [this.parentElement]
            return Array.from(observed.querySelectorAll(this.#match||':scope'))
        }

    }
</script>
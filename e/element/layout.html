<style></style>
<template><slot></slot></template>
<script>
    class extends `./abstract/pointer` {

    	constructor() {
    		super()
            Object.defineProperties(this, {
                _mode: {configurable: false, enumerable: false, writable: false, value: 'layout'}, 
                _parse: {configurable: false, enumerable: false, writable: false, value: async (response) => {
                    let text = await response.text(), template = document.createElement('template')
                    if (response.status >= 400) {
                        this.dispatchEvent(new CustomEvent('error', {detail: {type: 'fetch', status: response.status, message: text, input: response.url}}))
                        if (this.errors === 'throw') { throw new Error(text); return } else if (this.errors === 'hide') { return [] }
                    }
                    template.innerHTML = text
                    return template.content.cloneNode(true).children
                }},
                _as: {configurable: false, enumerable: false, writable: false, value: async (useResponse, addOrRemove, node, previousSibling, nextSibling, oldAttributeValues) => {
                    if (addOrRemove !== 'add') return 
                    const responseNodes = Array.from(useResponse).map(n => n.cloneNode(true))
                    let {from: useFromLayoutSelector, to: insertIntoLayoutAtSelector, use: usefromTargetSelector} = (this.as ? (this.e.utils.parseObjectAttribute(this.as) || {}) : {}), template = document.createElement('template')
                    template.content.replaceChildren(...responseNodes)
                    const documentFragment = template.content.cloneNode(true), replaceWithElements = useFromLayoutSelector ? documentFragment.querySelectorAll(useFromLayoutSelector) : documentFragment.children
                    if (insertIntoLayoutAtSelector) {
                        const insertContent = usefromTargetSelector === ':scope' ? node.childNodes 
                            : (usefromTargetSelector 
                                ? node.cloneNode(true).querySelectorAll(usefromTargetSelector) : [node.cloneNode(true)]) 
                        for (const r of replaceWithElements) {
                            const replaceAt = insertIntoLayoutAtSelector === ':scope' ? [r] : r.querySelectorAll(insertIntoLayoutAtSelector)
                            for (const rs of replaceAt) rs.replaceChildren(...insertContent)
                        }
                    }
                    if (!this.match) {
                        this.replaceWith(...replaceWithElements)
                    } else { node.replaceWith(...replaceWithElements) }
                    if (this.processor?.func) {
                        try {
                            if (typeof this.processor.func === 'function') this.processor.func(replaceWithElements)
                        } catch(e) {
                            this.dispatchEvent(new CustomEvent('error', {detail: {type: 'processor', message: e, input: node}}))
                            if (this.errors === 'throw') { throw new Error(e); return }
                        }
                    }                    
                }}
            })
    	}

		static get observedAttributes() { return (super.observedAttributes || []).concat() }

    }
</script>
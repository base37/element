<style></style>
<template></template>
<script>
    class extends `meta` {

        #name
        #processor
        #priority = 'auto'
        #cache = 'default'
        #fetchOptions = {}

        #defaultProcessor = function(router, mode, flag=undefined, get=false) {
            const url = `${router.baseURI}${mode}/${flag}${router._modes[mode]?.suffix?'.'+router._modes[mode].suffix:''}`
            return get ? fetch(this.e.getURL(url), Object.assign({priority: this.#priority, cache: this.#cache}, this.#fetchOptions)) : url
        }

    	constructor() {
    		super()
            this._modes || Object.defineProperty(this, '_modes', {enumerable: false, writable: false, value: this.e.env.modes})
            this._defaultProcessor || Object.defineProperty(this, '_defaultProcessor', {enumerable: false, writable: false, value: this.#defaultProcessor})
            for (const mode in this._modes) Object.defineProperty(this, mode, {configurable: true, enumerable: true, get: () => {
                let requestedProcessor = this.#processor ? this.e.processors[this.#processor] : undefined
                const f = typeof requestedProcessor === 'function' ? requestedProcessor.bind(this.e, this, mode) : this._defaultProcessor.bind(this.e, this, mode)
                f.toString = typeof requestedProcessor === 'function' ? requestedProcessor.bind(this.e, this, mode, this._modes[mode].default, false) : this._defaultProcessor.bind(this.e, this, mode, this._modes[mode].default, false)
                return f
            }})
    	}

        toString() { return this.#name }

        connectedCallback() {}

		static get observedAttributes() { return (super.observedAttributes || []).concat('name', 'processor', 'priority', 'cache') }

        set name(value) { if (value !== this.#name) this.#name = value }
        get name() { return this.#name }

        set processor(value) { this.#processor = value }
        get processor() { return this.#processor }

        set priority(value) { this.#priority = value }
        get priority() { return this.#priority }

        set cache(value) { this.#cache = value }
        get cache() { return this.#cache }

        set fetchOptions(value) { if (value instanceof Object) this.#fetchOptions = value }
        get fetchOptions() { return this.#fetchOptions }

    }
</script>